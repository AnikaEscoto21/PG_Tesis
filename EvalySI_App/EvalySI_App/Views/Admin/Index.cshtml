@model List<EvalySI_App.Models.DatosGenerales.CandidatoViewModel>

@{
    Layout = null;
    var totalCandidatos = Model.Count;
    var candidatosRecientes = Model.OrderByDescending(c => c.FechaRegistro).Take(5).Count();
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Administrador</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="~/css/admin.css">
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
    <div class="sidebar-header">
        <div class="logo-container">
            <img src="~/images/Logotipo.png" alt="Logo" class="logo-image" />
            <h3 class="logo-text">EvalySI</h3>
        </div>
    </div>
    
    <nav class="sidebar-nav">
        <a href="@Url.Action("Index", "Admin")" class="nav-item active">
            <i class="bi bi-people-fill"></i>
            <span>Candidatos</span>
        </a>
    </nav>
    
    <div class="sidebar-footer">
        <a asp-controller="Login" asp-action="Logout" class="nav-item logout-item" title="Cerrar Sesión">
            <i class="bi bi-box-arrow-left"></i>
            <span>Cerrar Sesión</span>
        </a>
    </div>
</div>

<!-- Main Content -->
<div class="main-content">
    <div class="dashboard-container">
        <!-- Header de la página -->
        <div class="dashboard-header">
            <div class="welcome-section">
                <h2 class="mb-0">Bienvenido "Administrador"</h2>
                <p class="text-muted mb-0">Panel de control de candidatos</p>
            </div>
            <div class="header-actions">
                <div class="user-info">
                    <span class="me-2">Usuario</span>
                    <i class="bi bi-person-circle fs-4"></i>
                </div>
            </div>
        </div>

        <!-- Tarjetas de estadísticas -->
        <div class="stats-grid">
            <div class="stat-card stat-card-dark">
                <div class="stat-content">
                    <div class="stat-header">
                        <span class="stat-label">Total de candidatos</span>
                        <i class="bi bi-people-fill stat-icon"></i>
                    </div>
                    <h2 class="stat-number">@totalCandidatos</h2>
                </div>
            </div>
            
            <div class="stat-card stat-card-light">
                <div class="stat-content">
                    <div class="stat-header">
                        <span class="stat-label">Total de visitantes</span>
                        <i class="bi bi-person-check-fill stat-icon"></i>
                    </div>
                    <h2 class="stat-number">@candidatosRecientes</h2>
                </div>
            </div>
        </div>

        <!-- Lista de candidatos -->
        <div class="candidates-section">
            <div class="section-header">
                <h5 class="section-title">Lista de Candidatos</h5>
            </div>

            @if (Model.Count == 0)
            {
                <div class="empty-state">
                    <i class="bi bi-inbox fs-1 text-muted"></i>
                    <p class="text-muted mt-3">No hay candidatos registrados en el sistema</p>
                </div>
            }
            else
            {
                <div class="table-container">
                    <div class="table-header">
                        <div class="search-wrapper">
                            <i class="bi bi-search search-icon"></i>
                            <input type="text" id="searchInput" class="search-input" placeholder="Buscar candidato...">
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="candidates-table" id="candidatosTable">
                            <thead>
                                <tr>
                                    <th>Nombre Completo</th>
                                    <th>DPI</th>
                                    <th>Teléfono</th>
                                    <th>Fecha de Registro</th>
                                    <th class="text-end">Acción</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var candidato in Model.OrderByDescending(c => c.FechaRegistro))
                                {
                                    <tr>
                                        <td class="candidate-name">@candidato.Nombres @candidato.Apellidos</td>
                                        <td>@(candidato.DPI ?? "N/A")</td>
                                        <td>@(candidato.TelefonoCelular ?? "N/A")</td>
                                        <td>@candidato.FechaRegistro.ToString("dd/MM/yyyy")</td>
                                        <td class="text-end">
                                            <a asp-action="Detalle" asp-route-id="@candidato.Id" class="btn-detail" title="Ver Detalle Completo">
                                                Ver Detalle
                                            </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                    <!-- Paginación -->
                    <div class="pagination-container">
                        <div class="pagination-info">
                            Mostrando <span id="showing-start">1</span> a <span id="showing-end">@Model.Count()</span> de <span id="total-items">@Model.Count()</span> candidatos
                        </div>
                        <div class="pagination-controls">
                            <button id="prev-page" class="pagination-btn" disabled>
                                <i class="bi bi-chevron-left"></i>
                                Anterior
                            </button>
                            <div class="pagination-pages" id="pagination-pages">
                                <button class="page-btn active">1</button>
                            </div>
                            <button id="next-page" class="pagination-btn" disabled>
                                Siguiente
                                <i class="bi bi-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            }
        </div>

        <!-- Logout Button -->
        <div class="logout-section">
            <a asp-controller="Login" asp-action="Logout" class="btn-logout" title="Cerrar Sesión">
                <i class="bi bi-box-arrow-left"></i>
            </a>
        </div>
    </div>
</div>

<!-- Modal de confirmación de eliminación -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteModalLabel">
                    <i class="bi bi-exclamation-triangle"></i> Confirmar Eliminación
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>¿Está seguro que desea eliminar al candidato <strong id="candidatoNombre"></strong>?</p>
                <p class="text-danger"><small>Esta acción no se puede deshacer.</small></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <form id="deleteForm" method="post" style="display: inline;">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-trash"></i> Eliminar
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Función de búsqueda en tiempo real
    document.getElementById('searchInput').addEventListener('keyup', function() {
        var input = this.value.toLowerCase();
        var table = document.getElementById('candidatosTable');
        var rows = table.getElementsByTagName('tr');

        for (var i = 1; i < rows.length; i++) {
            var row = rows[i];
            var text = row.textContent.toLowerCase();
            row.style.display = text.includes(input) ? '' : 'none';
        }
    });
</script>
</body>
</html>